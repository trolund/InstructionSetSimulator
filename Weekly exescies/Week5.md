# Week 5

    Suggested exercises:
    4.5, 4.6, 4.7.  


## 4.5

In this exercise, we examine in detail how an instruction is executed in a single-cycle datapath. Problems in this exercise refer to a clock cycle in which the processor fetches the following instruction word: 0x00c6ba23.

    (0x00c6ba23)_6 : (1100 0110 1011 1010 0010 0011)_2
    <=>
    (0x00c6ba23)_6 : (1100_01101_011_10100_0100011)_2


    | funct7   | rs2    | rs1    | funct3 | rd     | opcode   |
    |----------|--------|--------|--------|--------|----------|
    | 0000000  | 01100  | 01101  | 011    | 10100  | 0100011  |

Look at he green card!

For context: The encoded instruction is sd x12, 20(x13)


### 4.5.1 What are the values of the ALU control unit’s inputs for this instruction?

ALUOp:
00

ALU Control Lines:
0010


### 4.5.2 What is the new PC address after this instruction is executed? Highlight the path through which this value is determined.

The new PC is the old PC + 4. 

This signal goes from the PC, through the “PC + 4” adder, through the “branch” mux, and back to the PC.

### 4.5.3 For each mux, show the values of its inputs and outputs during the execution of this instruction. List values that are register outputs at Reg [xn].

ALUsrc: Inputs: Reg[x12] and 0x0000000000000014; 
        Output: 0x0000000000000014

MemToReg: Inputs: Reg[x13] + 0x14 and <undefined>; output: <undefined>

Branch: Inputs: PC+4 and PC + 0x28

!!! mangler


## 4.6 Section 4.4 does not discuss I-type instructions like addi or andi.

### 4.6.1 What additional logic blocks, if any, are needed to add I-type instructions to the CPU shown in Figure 4.21? Add any necessary logic blocks to Figure 4.21 and explain their purpose.

![Alt text](../Test%20exsams/img/4.21.png)

It can be seen that the imm is connected to the multiplexer feeding the ALU. Thereby implementing the data path needed.

Answer:

No additional logic blocks are needed.

### 4.6.2 List the values of the signals generated by the control unit for addi. Explain the reasoning for any “don’t care” control signals.

Opcode: 0 0 10 0 1 1 (jump over MemRead)

Answer:

footnote: Mathematically, the MemRead control wire is a “don’t care”: the instruction will run correctly regardless of the chosen value. Practically, however, MemRead should be set to false to prevent causing a segment fault or cache miss.

Branch: false
MemRead: false (See footnote from solution to problem 4.1.1.) MemToReg: 0
ALUop: 10 (or simply saying “add” is sufficient for this problem) MemWrite: false
ALUsrc: 1
RegWrite: true

## 4.7 Problems in this exercise assume that the logic blocks used to implement a processor’s datapath have the following latencies:

![Alt text](../Test%20exsams/img/w5_p5.png)

“Register read” is the time needed after the rising clock edge for the new register value to appear on the output. This value applies to the PC only. “Register setup” is the amount of time a register’s data input must be stable before the rising edge of the clock. This value applies to both the PC and Register File.

### 4.7.1 What is the latency of an R-type instruction(i.e.,how long must the clock period be to ensure that this instruction works correctly)?

ALU — R Type
Pipeline stages in r-type: Fetch, Decode, Execute, Write

Answer:
reg read + i-mem/d-mem + adder + mux * 2 + ALU + reg setup

R-type: 30 + 250 + 150 + 25 + 200 + 25 + 20 = 700ps

### 4.7.2 What is the latency of lw? (Check your answer carefully. Many students place extra muxes on the critical path.)
Answer:
ld: 30 + 250 + 150 + 25 + 200 + 250 + 25 + 20 = 950ps

### 4.7.3 What is the latency of sw? (Check your answer carefully. Many students place extra muxes on the critical path.)
Answer:
sd: 30 + 250 + 150 + 200 + 25 + 250 = 905

### 4.7.4 What is the latency of beq?
Answer:
beq: 30 + 250 + 150 + 25 + 200 + 5 + 25 + 20 = 705

### 4.7.5 What is the latency of an arithmetic, logical, or shift I-type (non-load) instruction?
Answer:
I-type: 30 + 250 + 150 + 25 + 200 + 25 + 20 = 700ps

### 4.7.6 What is the minimum clock period for this CPU?

Answer:

That is the defined by the longes (highest in time) path in the circuit. aka the max time of the times just found. 

950ps