# Problem 4

Consider the following caches. For all, assume 2KB size, 32-bit addresses, 32-bit words, and byte addressing:

**C1**: direct mapped with 2 word blocks.
**C2**: direct mapped with 4 word blocks.
**C3**: 2-way set associative with 2 word blocks and LRU replacement.

For each cache:

## Question 4.1

Show how binary addresses are divided into tag, index, block offset, and byte offset.

* memory size = 2KB size = 2048 = 2^11 
* 32-bit addresses
* 32-bit words
* byte addressing

### C1

**Byte offset** look at the addresses size

Byte offset = log_2(4) = 2 bits (4 bytes / 32 bit words)
Block offset = = log_2(2) = 1 bits (2 word blocks)
Block count = 2^11/2^2/2^1 = 2^8 = 256 blocks      # giver dermed også index
Index = 8 bits
Tag = 32 − 8 − 2 − 1 = 21 bits

### C2

Byte offset = log_2(4) = 2 bits (4 bytes / 32 bit words)
Block offset = = log_2(4) = 2 bits (4 word blocks)
Block count = 2^11/2^2/2^2 = 2^7 = 128 blocks      # giver dermed også index
Index = 7 bits
Tag = 32 − 7 − 2 − 2 = 21 bits

### C3

Byte offset = log_2(4) = 2 bits (4 bytes / 32 bit words)
Block offset = = log_2(2) = 1 bits (2 word blocks)
Blocks in set = 1 bits (2 blocks)                  # (2^1 = 2 (2-way))
Block count = 2^11/2^2/2^1/2^1 = 2^7 = 128 sets    # giver dermed også index, ekstra => (2^1 = 2 (2-way))
Index = 7 bits
Tag = 32 − 7 − 2 − 1 = 22 bits

## Question 4.2

Calculate the total number of bits required for the caches.

### C1

Overhead = 128 blocks * (21 tag + 1 valid) = 5632 bits
Total = 2KB * 8 + Overhead = 2048 * 8 + 5632 = 22016 bits

### C2

Overhead = 256 blocks * (21 tag + 1 valid) = 2816 bits
Total = 2KB * 8 + Overhead = 2048 * 8 + 2816 = 19200 bits

### C3
note : 2^1 blocks = 2 way

Overhead = 128 sets * 1 LRU + 2^7 sets * 2^1 blocks * (22 tag + 1 valid) = 6016 bits
Total = 2KB * 8 + Overhead = 2048 * 8 + 6016 = 22400 bits

## Question 4.3

### First convert all address to binary like:

binray adress

0
100
1000
1100
100000000000
1000
0
100000000000

### Then split it up according to the address subdivision in the table 

Remember: 

When doing direct mapped just do table like this:
![Alt text](img/direct_table.png)


Answer:

   |         |        |   C1  |        |          |   |        |   C2  |        |          |   |        |   C3  |        |          |
   |---------|--------|:-----:|:------:|----------|---|--------|:-----:|:------:|----------|---|--------|:-----:|:------:|----------|
   | Address |   Tag  | Index | Offset | Hit/Miss |   |   Tag  | Index | Offset | Hit/Miss |   |   Tag  | Index | Offset | Hit/Miss |
   |   000   |    0   |   0   |    0   |          |   |    0   |   0   |    0   |          |   |    0   |   0   |    0   |          |
   |   004   |    0   |   0   |   100  |          |   |    0   |   0   |   100  |          |   |    0   |   0   |   100  |          |
   |   008   |    0   |   1   |    0   |          |   |    0   |   0   |  1000  |          |   |    0   |   1   |    0   |          |
   |   00C   |    0   |   1   |   100  |          |   |    0   |   0   |  1100  |          |   |   10   |   1   |   100  |          |
   |    8    |    1   |   0   |    0   |          |   |    1   |   0   |    0   |          |   |    0   |   0   |    0   |          |
   |   008   |    0   |   1   |    0   |          |   |    0   |   0   |  1000  |          |   |    0   |   1   |    0   |          |
   |   000   |    0   |   0   |    0   |          |   |    0   |   0   |    0   |          |   |    0   |   0   |    0   |          |
   |    8    |    1   |   0   |    0   |          |   |    1   |   0   |    0   |          |   |   10   |   0   |    0   |          |
   |         | 21 bit | 8 bit | 3 bit  |          |   | 22 bit | 7 bit | 4 bit  |          |   | 22 bit | 7 bit | 3 bit  |          |


## Question 4.4

c1 = 3/8
c2 = 4/8
c3 = 5/8


# Problem 5

Consider a program executing 10^7 instructions with the following mix of operations:

![Alt text](img/p517.1.png)


A processor P1 requires the following number of cycles:

![Alt text](img/p517.2.png)

## Question 5.1

Determine the CPI for the benchmark program.

Answer:

CPI = (12 * 0.2 + 5 * 0.3 + 3 * 0.1 + 4 * 0.4) = 5.8

## Question 5.2

For a clock rate of 3 GHz, what is the CPU execution time?

Answer:

      period = 1 / 3 GHz = 1 / 3 * 10^9

      CPI * period * program = execution time in sec

5.8 * 1/(3*10^9) * 10^7 = 0.01933333333 s = 19.3 ms

**Additional information about the cache.**

Instruction miss rate is 5%. Data miss rate per cache access is 12%. Miss penalty for both data and instructions is 8 cycles.

## Question 5.3

Determine the execution time including memory stalls.

Answer:

      Miss CPI = (instructions percent) × (miss rate) × (miss penalty) 

Instruction miss CPI = 1.0 × 0.05 × 8 = 0.4 

lw, sw miss CPI = 0.3 × 0.12 × 8 = 0.288 ≃ 0.3

The sum of the Instruction miss rate and Data miss rate:

Excess CPI (due to misses) = 0.4 + 0.3 = 0.7

Ideal CPI (Q 5.1) = 5.8 

New CPI with stalls:

CPI (including cache misses) = 5.8 + 0.7 = 6.5

The time of the execution with stall is then calculated like:

Benchmark program = 10^7

t_exe = (6.5 × 10^7)/(3 × 10^9) = 2.16 × 10^−2 = 21.7 ms
